"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
// Drawing functions in canvas
var initDrawingPt = false;
var prevMouseX = 0;
var currMouseX = 0;
var prevMouseY = 0;
var currMouseY = 0;

var prevMouseX2 = 0;
var currMouseX2 = 0;
var prevMouseY2 = 0;
var currMouseY2 = 0;

var lineWidth = 3;
var color = "black";

function drawGesture(canvas, res, e) {
  var ctx = canvas.getContext("2d");
  if (res == 'down') {
    // clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    prevMouseX = currMouseX;
    prevMouseY = currMouseY;
    currMouseX = e.clientX - canvas.offsetLeft;
    currMouseY = e.clientY - canvas.offsetTop;
    initDrawingPt = true;
    if (initDrawingPt) {
      ctx.beginPath();
      ctx.fillStyle = color;
      ctx.arc(currMouseX, currMouseY, 5, 0, Math.PI * 2, true);
      ctx.fill();
      ctx.closePath();
      initDrawingPt = false;
    }
  }
  if (res == 'move') {
    prevMouseX = currMouseX;
    prevMouseY = currMouseY;
    currMouseX = e.clientX - canvas.offsetLeft;
    currMouseY = e.clientY - canvas.offsetTop;
    ctx.beginPath();
    ctx.moveTo(prevMouseX, prevMouseY);
    ctx.lineTo(currMouseX, currMouseY);
    ctx.strokeStyle = color;
    ctx.lineWidth = lineWidth;
    ctx.stroke();
    ctx.closePath();
  }
}

function line_partition(canvas, gesture) {
  var ctx = canvas.getContext("2d");

  prevMouseX2 = currMouseX2;
  prevMouseY2 = currMouseY2;
  currMouseX2 = gesture[0][0] * 484 - canvas.offsetLeft;
  currMouseY2 = gesture[0][1] * 784 - canvas.offsetTop;

  for (var i = 1; i < gesture.length; i++) {
    prevMouseX2 = currMouseX2;
    prevMouseY2 = currMouseY2;
    currMouseX2 = gesture[i][0] * 484 - canvas.offsetLeft;
    currMouseY2 = gesture[i][1] * 784 - canvas.offsetTop;
    ctx.beginPath();
    ctx.moveTo(prevMouseX2, prevMouseY2);
    ctx.lineTo(currMouseX2, currMouseY2);
    ctx.strokeStyle = color;
    ctx.lineWidth = lineWidth;
    ctx.stroke();
    ctx.closePath();
  }
}

function addGestureThumbnail(canvas, gesture_id) {
  // declare the canva where to draw a thumbnail
  var thumbCnvs = document.createElement('canvas');
  thumbCnvs.width = 70;
  thumbCnvs.height = 70;
  thumbCnvs.style.border = "1px solid";
  // get context to fill with bkg color and image
  var ctx = thumbCnvs.getContext('2d');
  ctx.fillStyle = "white";
  ctx.fillRect(0, 0, thumbCnvs.width, thumbCnvs.height);
  ctx.drawImage(canvas, 0, 0, canvas.width, canvas.height, 0, 0, thumbCnvs.width, thumbCnvs.height);
  // add to the body document
  var body = document.getElementsByTagName("body")[0];
  body.appendChild(thumbCnvs);
}

function getMouseXYinCanvas(canvas, e) {
  var _canvas$getBoundingCl = canvas.getBoundingClientRect(),
      top = _canvas$getBoundingCl.top,
      left = _canvas$getBoundingCl.left,
      width = _canvas$getBoundingCl.width,
      height = _canvas$getBoundingCl.height;

  var clientX = (e.pageX - left) / width;
  var clientY = (e.pageY - top) / height;
  return [clientX, clientY];
}

function addBoxToBody(width, height, name, boxtitle) {
  // create outer DIV
  var iDiv = document.createElement('div');
  iDiv.id = 'block-' + String(Math.random() * 10000);
  iDiv.className = 'box';
  document.getElementsByTagName('body')[0].appendChild(iDiv);
  // create canvas
  var canvas = document.createElement('canvas');
  canvas.width = width;
  canvas.height = height;
  canvas.style.border = "0px";
  canvas.id = name;
  var ctx = canvas.getContext('2d');
  ctx.fillStyle = "white";
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  var div = document.getElementById(iDiv.id);
  div.appendChild(canvas);
  // create div for title
  var titleDiv = document.createElement('div');
  titleDiv.className = 'boxtitle';
  titleDiv.innerHTML += boxtitle;
  div.appendChild(titleDiv);
}

exports.addBoxToBody = addBoxToBody;
exports.drawGesture = drawGesture;
exports.line_partition = line_partition;
exports.addGestureThumbnail = addGestureThumbnail;
exports.getMouseXYinCanvas = getMouseXYinCanvas;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRyYXcuanMiXSwibmFtZXMiOlsiaW5pdERyYXdpbmdQdCIsInByZXZNb3VzZVgiLCJjdXJyTW91c2VYIiwicHJldk1vdXNlWSIsImN1cnJNb3VzZVkiLCJwcmV2TW91c2VYMiIsImN1cnJNb3VzZVgyIiwicHJldk1vdXNlWTIiLCJjdXJyTW91c2VZMiIsImxpbmVXaWR0aCIsImNvbG9yIiwiZHJhd0dlc3R1cmUiLCJjYW52YXMiLCJyZXMiLCJlIiwiY3R4IiwiZ2V0Q29udGV4dCIsImNsZWFyUmVjdCIsIndpZHRoIiwiaGVpZ2h0IiwiY2xpZW50WCIsIm9mZnNldExlZnQiLCJjbGllbnRZIiwib2Zmc2V0VG9wIiwiYmVnaW5QYXRoIiwiZmlsbFN0eWxlIiwiYXJjIiwiTWF0aCIsIlBJIiwiZmlsbCIsImNsb3NlUGF0aCIsIm1vdmVUbyIsImxpbmVUbyIsInN0cm9rZVN0eWxlIiwic3Ryb2tlIiwibGluZV9wYXJ0aXRpb24iLCJnZXN0dXJlIiwiaSIsImxlbmd0aCIsImFkZEdlc3R1cmVUaHVtYm5haWwiLCJnZXN0dXJlX2lkIiwidGh1bWJDbnZzIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50Iiwic3R5bGUiLCJib3JkZXIiLCJmaWxsUmVjdCIsImRyYXdJbWFnZSIsImJvZHkiLCJnZXRFbGVtZW50c0J5VGFnTmFtZSIsImFwcGVuZENoaWxkIiwiZ2V0TW91c2VYWWluQ2FudmFzIiwiZ2V0Qm91bmRpbmdDbGllbnRSZWN0IiwidG9wIiwibGVmdCIsInBhZ2VYIiwicGFnZVkiLCJhZGRCb3hUb0JvZHkiLCJuYW1lIiwiYm94dGl0bGUiLCJpRGl2IiwiaWQiLCJTdHJpbmciLCJyYW5kb20iLCJjbGFzc05hbWUiLCJkaXYiLCJnZXRFbGVtZW50QnlJZCIsInRpdGxlRGl2IiwiaW5uZXJIVE1MIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFBO0FBQ0EsSUFBSUEsZ0JBQWdCLEtBQXBCO0FBQ0EsSUFBSUMsYUFBYSxDQUFqQjtBQUNBLElBQUlDLGFBQWEsQ0FBakI7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dUIsS0FBdkIsQ0FBZjtBQUNBd0IsV0FBU0gsU0FBVCxHQUFxQixVQUFyQjtBQUNBRyxXQUFTQyxTQUFULElBQXNCVCxRQUF0QjtBQUNBTSxNQUFJZixXQUFKLENBQWdCaUIsUUFBaEI7QUFDRDs7UUFHUVYsWSxHQUFBQSxZO1FBQWM5QyxXLEdBQUFBLFc7UUFBYXdCLGMsR0FBQUEsYztRQUFnQkksbUIsR0FBQUEsbUI7UUFBcUJZLGtCLEdBQUFBLGtCIiwiZmlsZSI6ImRyYXcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBEcmF3aW5nIGZ1bmN0aW9ucyBpbiBjYW52YXNcbmxldCBpbml0RHJhd2luZ1B0ID0gZmFsc2U7XG5sZXQgcHJldk1vdXNlWCA9IDA7XG5sZXQgY3Vyck1vdXNlWCA9IDA7XG5sZXQgcHJldk1vdXNlWSA9IDA7XG5sZXQgY3Vyck1vdXNlWSA9IDA7XG5cbmxldCBwcmV2TW91c2VYMiA9IDA7XG5sZXQgY3Vyck1vdXNlWDIgPSAwO1xubGV0IHByZXZNb3VzZVkyID0gMDtcbmxldCBjdXJyTW91c2VZMiA9IDA7XG5cbmxldCBsaW5lV2lkdGggPSAzO1xubGV0IGNvbG9yID0gXCJibGFja1wiO1xuXG5mdW5jdGlvbiBkcmF3R2VzdHVyZShjYW52YXMsIHJlcywgZSkge1xuICBsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgaWYgKHJlcyA9PSAnZG93bicpIHtcbiAgICAvLyBjbGVhciBjYW52YXNcbiAgICBjdHguY2xlYXJSZWN0KDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG4gICAgcHJldk1vdXNlWCA9IGN1cnJNb3VzZVg7XG4gICAgcHJldk1vdXNlWSA9IGN1cnJNb3VzZVk7XG4gICAgY3Vyck1vdXNlWCA9IGUuY2xpZW50WCAtIGNhbnZhcy5vZmZzZXRMZWZ0O1xuICAgIGN1cnJNb3VzZVkgPSBlLmNsaWVudFkgLSBjYW52YXMub2Zmc2V0VG9wO1xuICAgIGluaXREcmF3aW5nUHQgPSB0cnVlO1xuICAgIGlmIChpbml0RHJhd2luZ1B0KSB7XG4gICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgY3R4LmZpbGxTdHlsZSA9IGNvbG9yO1xuICAgICAgICBjdHguYXJjKGN1cnJNb3VzZVgsIGN1cnJNb3VzZVksIDUsIDAsIE1hdGguUEkgKiAyLCB0cnVlKTtcbiAgICAgICAgY3R4LmZpbGwoKTtcbiAgICAgICAgY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICBpbml0RHJhd2luZ1B0ID0gZmFsc2U7XG4gICAgfVxuICB9XG4gIGlmIChyZXMgPT0gJ21vdmUnKSB7XG4gICAgcHJldk1vdXNlWCA9IGN1cnJNb3VzZVg7XG4gICAgcHJldk1vdXNlWSA9IGN1cnJNb3VzZVk7XG4gICAgY3Vyck1vdXNlWCA9IGUuY2xpZW50WCAtIGNhbnZhcy5vZmZzZXRMZWZ0O1xuICAgIGN1cnJNb3VzZVkgPSBlLmNsaWVudFkgLSBjYW52YXMub2Zmc2V0VG9wO1xuICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICBjdHgubW92ZVRvKHByZXZNb3VzZVgsIHByZXZNb3VzZVkpO1xuICAgIGN0eC5saW5lVG8oY3Vyck1vdXNlWCwgY3Vyck1vdXNlWSk7XG4gICAgY3R4LnN0cm9rZVN0eWxlID0gY29sb3I7XG4gICAgY3R4LmxpbmVXaWR0aCA9IGxpbmVXaWR0aDsgXG4gICAgY3R4LnN0cm9rZSgpO1xuICAgIGN0eC5jbG9zZVBhdGgoKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsaW5lX3BhcnRpdGlvbihjYW52YXMsIGdlc3R1cmUpe1xuXHRsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcblx0XG5cdHByZXZNb3VzZVgyID0gY3Vyck1vdXNlWDI7XG4gICAgcHJldk1vdXNlWTIgPSBjdXJyTW91c2VZMjtcbiAgICBjdXJyTW91c2VYMiA9IGdlc3R1cmVbMF1bMF0qNDg0IC0gY2FudmFzLm9mZnNldExlZnQ7XG4gICAgY3Vyck1vdXNlWTIgPSBnZXN0dXJlWzBdWzFdKjc4NCAtIGNhbnZhcy5vZmZzZXRUb3A7XG4gICAgXG5cdGZvcihsZXQgaSA9IDE7IGkgPCBnZXN0dXJlLmxlbmd0aDsgaSsrKXtcblx0XHRwcmV2TW91c2VYMiA9IGN1cnJNb3VzZVgyO1xuXHRcdHByZXZNb3VzZVkyID0gY3Vyck1vdXNlWTI7XG5cdFx0Y3Vyck1vdXNlWDIgPSBnZXN0dXJlW2ldWzBdKjQ4NCAtIGNhbnZhcy5vZmZzZXRMZWZ0O1xuXHRcdGN1cnJNb3VzZVkyID0gZ2VzdHVyZVtpXVsxXSo3ODQgLSBjYW52YXMub2Zmc2V0VG9wO1xuXHRcdGN0eC5iZWdpblBhdGgoKTtcblx0XHRjdHgubW92ZVRvKHByZXZNb3VzZVgyLCBwcmV2TW91c2VZMik7XG5cdFx0Y3R4LmxpbmVUbyhjdXJyTW91c2VYMiwgY3Vyck1vdXNlWTIpO1xuXHRcdGN0eC5zdHJva2VTdHlsZSA9IGNvbG9yO1xuXHRcdGN0eC5saW5lV2lkdGggPSBsaW5lV2lkdGg7IFxuXHRcdGN0eC5zdHJva2UoKTtcblx0XHRjdHguY2xvc2VQYXRoKCk7XG5cdH1cbn1cblxuZnVuY3Rpb24gYWRkR2VzdHVyZVRodW1ibmFpbChjYW52YXMsIGdlc3R1cmVfaWQpIHtcbiAgICAvLyBkZWNsYXJlIHRoZSBjYW52YSB3aGVyZSB0byBkcmF3IGEgdGh1bWJuYWlsXG4gICAgbGV0IHRodW1iQ252cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgIHRodW1iQ252cy53aWR0aCA9IDcwO1xuICAgIHRodW1iQ252cy5oZWlnaHQgPSA3MDtcbiAgICB0aHVtYkNudnMuc3R5bGUuYm9yZGVyID0gXCIxcHggc29saWRcIjtcbiAgICAvLyBnZXQgY29udGV4dCB0byBmaWxsIHdpdGggYmtnIGNvbG9yIGFuZCBpbWFnZVxuICAgIGxldCBjdHggPSB0aHVtYkNudnMuZ2V0Q29udGV4dCgnMmQnKTtcbiAgICBjdHguZmlsbFN0eWxlID0gXCJ3aGl0ZVwiO1xuICAgIGN0eC5maWxsUmVjdCgwLCAwLCB0aHVtYkNudnMud2lkdGgsIHRodW1iQ252cy5oZWlnaHQpOyBcbiAgICBjdHguZHJhd0ltYWdlKGNhbnZhcywgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0LCAwLCAwLCB0aHVtYkNudnMud2lkdGgsIHRodW1iQ252cy5oZWlnaHQpO1xuICAgIC8vIGFkZCB0byB0aGUgYm9keSBkb2N1bWVudFxuICAgIHZhciBib2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJib2R5XCIpWzBdO1xuICAgIGJvZHkuYXBwZW5kQ2hpbGQodGh1bWJDbnZzKTtcbn1cblxuXG5mdW5jdGlvbiBnZXRNb3VzZVhZaW5DYW52YXMoY2FudmFzLCBlKSB7XG4gIGNvbnN0IHsgdG9wLCBsZWZ0LCB3aWR0aCwgaGVpZ2h0IH0gPSBjYW52YXMuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gIGNvbnN0IGNsaWVudFggPSAoZS5wYWdlWCAtIGxlZnQpIC8gd2lkdGg7XG4gIGNvbnN0IGNsaWVudFkgPSAoZS5wYWdlWSAtIHRvcCkgLyBoZWlnaHQ7XG4gIHJldHVybiBbY2xpZW50WCwgY2xpZW50WV1cbn1cblxuZnVuY3Rpb24gYWRkQm94VG9Cb2R5KHdpZHRoLCBoZWlnaHQsIG5hbWUsIGJveHRpdGxlKSB7XG4gIC8vIGNyZWF0ZSBvdXRlciBESVZcbiAgdmFyIGlEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgaURpdi5pZCA9ICdibG9jay0nK1N0cmluZyhNYXRoLnJhbmRvbSgpICogMTAwMDApO1xuICBpRGl2LmNsYXNzTmFtZSA9ICdib3gnO1xuICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnYm9keScpWzBdLmFwcGVuZENoaWxkKGlEaXYpO1xuICAvLyBjcmVhdGUgY2FudmFzXG4gIGxldCBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgY2FudmFzLndpZHRoID0gd2lkdGg7XG4gIGNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7XG4gIGNhbnZhcy5zdHlsZS5ib3JkZXIgPSBcIjBweFwiO1xuICBjYW52YXMuaWQgPSBuYW1lO1xuICBsZXQgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gIGN0eC5maWxsU3R5bGUgPSBcIndoaXRlXCI7XG4gIGN0eC5maWxsUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOyBcbiAgbGV0IGRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlEaXYuaWQpO1xuICBkaXYuYXBwZW5kQ2hpbGQoY2FudmFzKTtcbiAgLy8gY3JlYXRlIGRpdiBmb3IgdGl0bGVcbiAgbGV0IHRpdGxlRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIHRpdGxlRGl2LmNsYXNzTmFtZSA9ICdib3h0aXRsZSc7XG4gIHRpdGxlRGl2LmlubmVySFRNTCArPSBib3h0aXRsZTtcbiAgZGl2LmFwcGVuZENoaWxkKHRpdGxlRGl2KTtcbn1cblxuXG5leHBvcnQgeyBhZGRCb3hUb0JvZHksIGRyYXdHZXN0dXJlLCBsaW5lX3BhcnRpdGlvbiwgYWRkR2VzdHVyZVRodW1ibmFpbCwgZ2V0TW91c2VYWWluQ2FudmFzIH07XG4iXX0=