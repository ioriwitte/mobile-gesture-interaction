'use strict';

var _draw = require('./lib/draw');

var draw = _interopRequireWildcard(_draw);

var _dataset = require('./lib/dataset');

var _dataset2 = _interopRequireDefault(_dataset);

var _recognizer = require('./lib/recognizer');

var _recognizer2 = _interopRequireDefault(_recognizer);

var _images = require('./lib/images');

var images = _interopRequireWildcard(_images);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

var $drawing = document.querySelector('#drawCan');

var letsDraw = false;
var currentGesture = [];
var gestureID = 12;
var trainingMode = false;
var firstDraw = false;

var itemx = [];
var itemy = [];
var iconID = [];
var part = [];
var coord = [[2, 75, 100], [1, 175, 100], [2, 275, 100], [2, 375, 100], [1, 75, 180], [3, 175, 180], [3, 275, 180], [1, 375, 180], [1, 75, 260], [2, 175, 260], [1, 275, 260], [3, 375, 260], [4, 75, 340], [4, 175, 340], [4, 275, 340], [4, 375, 340], [1, 75, 420], [3, 175, 420], [2, 275, 420], [1, 375, 420], [4, 75, 500], [4, 175, 500], [4, 275, 500], [4, 375, 500], [2, 75, 580], [1, 175, 580], [2, 275, 580], [2, 375, 580]];

var lx = 0.0;

var sort = false;
var sorted1 = false;
var sorted2 = false;
var partition = false;
var select = false;

var dataset = new _dataset2.default();
var myRecognizer = new _recognizer2.default();

window.onload = function () {
	myRecognizer.fit(dataset);

	images.init(dataset);
	images.drawImages($drawing.getContext("2d"));
	itemx = [75, 175, 275, 375];
	itemy = [100, 180, 260, 340, 420, 500, 580];
};

// start when mouse is down
$drawing.addEventListener('mousedown', function (e) {

	if (e.clientY < 684 && e.clientY > 668) {
		if (e.clientX > 208 && e.clientX < 225) {
			// "Type" box
			if (!sorted1) {
				coord = images.sort('type');
				sorted1 = true;
			} else {
				coord = images.sort('dis-type');
				sorted1 = false;
			}
			images.drawImages($drawing.getContext("2d"));
			sort = true;
			letsDraw = false;
		} else if (e.clientX > 84 && e.clientX < 101) {
			// "Date" box
			if (!sorted2) {
				coord = images.sort('date');
				sorted2 = true;
			} else {
				coord = images.sort('dis-date');
				sorted2 = false;
			}
			images.drawImages($drawing.getContext("2d"));
			sort = true;
			letsDraw = false;
		}
	} else {
		// Selection
		if (select) {
			draw.drawGesture($drawing, 'down', e);
			images.selection($drawing.getContext("2d"), iconID);

			var coordinates = draw.getMouseXYinCanvas($drawing, e);
			currentGesture.push(coordinates);
		} else {
			// Partition
			if (partition) {
				lx = draw.getMouseXYinCanvas($drawing, e)[0];
				images.draw_partition($drawing, iconID);
				draw.line_partition($drawing, currentGesture);
			} else {
				// Initial state
				draw.drawGesture($drawing, 'down', e);
				images.drawImages($drawing.getContext("2d"));

				var _coordinates = draw.getMouseXYinCanvas($drawing, e);
				currentGesture.push(_coordinates);
			}
		}
		letsDraw = true;
	}
});

// start when mouse is down and moving
$drawing.addEventListener('mousemove', function (e) {
	if (letsDraw && !sort) {
		if (!partition) {
			draw.drawGesture($drawing, 'move', e);
			var coordinates = draw.getMouseXYinCanvas($drawing, e);
			currentGesture.push(coordinates);
		} else {
			var x = draw.getMouseXYinCanvas($drawing, e)[0];
			currentGesture = myRecognizer.move_partition(currentGesture, x, lx);
			lx = x;

			part = images.partition(currentGesture, iconID);

			images.draw_partition($drawing, part, iconID);
			draw.line_partition($drawing, currentGesture);
		}
	}
});

// stop when mouse is up
$drawing.addEventListener('mouseup', function (e) {
	letsDraw = false;
	if (sort) {
		sort = false;
	} else {
		if (trainingMode) {
			dataset.addGestureWithLabel(currentGesture, gestureID);
			dataset.plotDatasetInHML();
			gestureID++;
		} else {
			if (partition) {
				part = images.partition(currentGesture, iconID);
				images.draw_partition($drawing, part, iconID);
				partition = false;
			} else {
				var predictedLabel = myRecognizer.predict(currentGesture);
				if (predictedLabel == 11) {
					images.setCoordinates(coord);
					images.drawImages($drawing.getContext("2d"));
				}
				if (select) {
					if (predictedLabel == 9 || predictedLabel == 10) {
						console.log("partition");
						part = images.partition(currentGesture, iconID);
						images.draw_partition($drawing, part, iconID);
						select = false;
						partition = true;
						draw.line_partition($drawing, currentGesture);
					}
				} else if (predictedLabel < 9 && predictedLabel > 0) {
					iconID = myRecognizer.select(currentGesture, itemx, itemy);
					if (iconID.length > 0) {
						images.selection($drawing.getContext("2d"), iconID);
						select = true;
						console.log("selection");
					}
				}
			}
		}
	}
	if (!partition) currentGesture = [];
});
/*
// Buttons "Training" and "Testing"
const $trainingBtn = document.querySelector('#trainingBtn');
const $testingBtn = document.querySelector('#testingBtn');

$trainingBtn.addEventListener('click', function(e) {
	trainingMode = true;	
});

$testingBtn.addEventListener('click', function(e) {
	myRecognizer.fit(dataset);
	trainingMode = false;
});*/
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImRyYXciLCJpbWFnZXMiLCIkZHJhd2luZyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImxldHNEcmF3IiwiY3VycmVudEdlc3R1cmUiLCJnZXN0dXJlSUQiLCJ0cmFpbmluZ01vZGUiLCJmaXJzdERyYXciLCJpdGVteCIsIml0ZW15IiwiaWNvbklEIiwicGFydCIsImNvb3JkIiwibHgiLCJzb3J0Iiwic29ydGVkMSIsInNvcnRlZDIiLCJwYXJ0aXRpb24iLCJzZWxlY3QiLCJkYXRhc2V0IiwibXlSZWNvZ25pemVyIiwid2luZG93Iiwib25sb2FkIiwiZml0IiwiaW5pdCIsImRyYXdJbWFnZXMiLCJnZXRDb250ZXh0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJjbGllbnRZIiwiY2xpZW50WCIsImRyYXdHZXN0dXJlIiwic2VsZWN0aW9uIiwiY29vcmRpbmF0ZXMiLCJnZXRNb3VzZVhZaW5DYW52YXMiLCJwdXNoIiwiZHJhd19wYXJ0aXRpb24iLCJsaW5lX3BhcnRpdGlvbiIsIngiLCJtb3ZlX3BhcnRpdGlvbiIsImFkZEdlc3R1cmVXaXRoTGFiZWwiLCJwbG90RGF0YXNldEluSE1MIiwicHJlZGljdGVkTGFiZWwiLCJwcmVkaWN0Iiwic2V0Q29vcmRpbmF0ZXMiLCJjb25zb2xlIiwibG9nIiwibGVuZ3RoIl0sIm1hcHBpbmdzIjoiOztBQUFBOztJQUFZQSxJOztBQUNaOzs7O0FBQ0E7Ozs7QUFDQTs7SUFBWUMsTTs7Ozs7O0FBRVosSUFBTUMsV0FBV0MsU0FBU0MsYUFBVCxDQUF1QixVQUF2QixDQUFqQjs7QUFFQSxJQUFJQyxXQUFXLEtBQWY7QUFDQSxJQUFJQyxpQkFBaUIsRUFBckI7QUFDQSxJQUFJQyxZQUFZLEVBQWhCO0FBQ0EsSUFBSUMsZUFBZSxLQUFuQjtBQUNBLElBQUlDLFlBQVksS0FBaEI7O0FBRUEsSUFBSUMsUUFBUSxFQUFaO0FBQ0EsSUFBSUMsUUFBUSxFQUFaO0FBQ0EsSUFBSUMsU0FBUyxF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Qy9DRyxjQUFRQyxHQUFSLENBQVksV0FBWjtBQUNBbkMsYUFBT1osT0FBT2tCLFNBQVAsQ0FBaUJiLGNBQWpCLEVBQWlDTSxNQUFqQyxDQUFQO0FBQ0FYLGFBQU9xQyxjQUFQLENBQXNCcEMsUUFBdEIsRUFBZ0NXLElBQWhDLEVBQXNDRCxNQUF0QztBQUNBUSxlQUFTLEtBQVQ7QUFDQUQsa0JBQVksSUFBWjtBQUNBbkIsV0FBS3VDLGNBQUwsQ0FBb0JyQyxRQUFwQixFQUE4QkksY0FBOUI7QUFDQTtBQUNELEtBVEQsTUFVSyxJQUFHc0MsaUJBQWlCLENBQWpCLElBQXNCQSxpQkFBaUIsQ0FBMUMsRUFBNkM7QUFDakRoQyxjQUFTVSxhQUFhRixNQUFiLENBQW9CZCxjQUFwQixFQUFvQ0ksS0FBcEMsRUFBMkNDLEtBQTNDLENBQVQ7QUFDQSxTQUFHQyxPQUFPcUMsTUFBUCxHQUFnQixDQUFuQixFQUFzQjtBQUNyQmhELGFBQU9pQyxTQUFQLENBQWlCaEMsU0FBUzBCLFVBQVQsQ0FBb0IsSUFBcEIsQ0FBakIsRUFBNENoQixNQUE1QztBQUNBUSxlQUFTLElBQVQ7QUFDQTJCLGNBQVFDLEdBQVIsQ0FBWSxXQUFaO0FBQ0E7QUFDRDtBQUNEO0FBQ0Q7QUFDRDtBQUNELEtBQUcsQ0FBQzdCLFNBQUosRUFDQ2IsaUJBQWlCLEVBQWpCO0FBQ0QsQ0E5Q0Q7QUErQ0EiLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBkcmF3IGZyb20gJy4vbGliL2RyYXcnXG5pbXBvcnQgRGF0YXNldCBmcm9tICcuL2xpYi9kYXRhc2V0J1xuaW1wb3J0IFJlY29nbml6ZXIgZnJvbSAnLi9saWIvcmVjb2duaXplcidcbmltcG9ydCAqIGFzIGltYWdlcyBmcm9tICcuL2xpYi9pbWFnZXMnXG5cbmNvbnN0ICRkcmF3aW5nID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RyYXdDYW4nKTtcblxubGV0IGxldHNEcmF3ID0gZmFsc2U7XG5sZXQgY3VycmVudEdlc3R1cmUgPSBbXTtcbmxldCBnZXN0dXJlSUQgPSAxMjtcbmxldCB0cmFpbmluZ01vZGUgPSBmYWxzZTtcbmxldCBmaXJzdERyYXcgPSBmYWxzZTtcblxubGV0IGl0ZW14ID0gW107XG5sZXQgaXRlbXkgPSBbXTtcbmxldCBpY29uSUQgPSBbXTtcbmxldCBwYXJ0ID0gW107XG5sZXQgY29vcmQgPSBbWzIsNzUsMTAwXSxbMSwxNzUsMTAwXSxbMiwyNzUsMTAwXSxbMiwzNzUsMTAwXSxcblx0WzEsNzUsMTgwXSxbMywxNzUsMTgwXSxbMywyNzUsMTgwXSxbMSwzNzUsMTgwXSxcblx0WzEsNzUsMjYwXSxbMiwxNzUsMjYwXSxbMSwyNzUsMjYwXSxbMywzNzUsMjYwXSxcblx0WzQsNzUsMzQwXSxbNCwxNzUsMzQwXSxbNCwyNzUsMzQwXSxbNCwzNzUsMzQwXSxcblx0WzEsNzUsNDIwXSxbMywxNzUsNDIwXSxbMiwyNzUsNDIwXSxbMSwzNzUsNDIwXSxcblx0WzQsNzUsNTAwXSxbNCwxNzUsNTAwXSxbNCwyNzUsNTAwXSxbNCwzNzUsNTAwXSxcblx0WzIsNzUsNTgwXSxbMSwxNzUsNTgwXSxbMiwyNzUsNTgwXSxbMiwzNzUsNTgwXV07XG5cbmxldCBseCA9IDAuMDtcblxubGV0IHNvcnQgPSBmYWxzZTtcbmxldCBzb3J0ZWQxID0gZmFsc2U7XG5sZXQgc29ydGVkMiA9IGZhbHNlO1xubGV0IHBhcnRpdGlvbiA9IGZhbHNlO1xubGV0IHNlbGVjdCA9IGZhbHNlO1xuXG5sZXQgZGF0YXNldCA9IG5ldyBEYXRhc2V0KCk7XG5sZXQgbXlSZWNvZ25pemVyID0gbmV3IFJlY29nbml6ZXIoKTtcblxud2luZG93Lm9ubG9hZCA9IGZ1bmN0aW9uKCl7XG5cdG15UmVjb2duaXplci5maXQoZGF0YXNldCk7XG5cdFxuXHRpbWFnZXMuaW5pdChkYXRhc2V0KTtcblx0aW1hZ2VzLmRyYXdJbWFnZXMoJGRyYXdpbmcuZ2V0Q29udGV4dChcIjJkXCIpKTtcblx0aXRlbXggPSBbNzUsMTc1LDI3NSwzNzVdO1xuXHRpdGVteSA9IFsxMDAsMTgwLDI2MCwzNDAsNDIwLDUwMCw1ODBdO1xufTtcblxuLy8gc3RhcnQgd2hlbiBtb3VzZSBpcyBkb3duXG4kZHJhd2luZy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBmdW5jdGlvbihlKSB7XG5cdFxuXHRpZiAoZS5jbGllbnRZIDwgNjg0ICYmIGUuY2xpZW50WSA+IDY2OCl7XG5cdFx0aWYoZS5jbGllbnRYID4gMjA4ICYmIGUuY2xpZW50WCA8IDIyNSl7IC8vIFwiVHlwZVwiIGJveFxuXHRcdFx0aWYoIXNvcnRlZDEpe1xuXHRcdFx0XHRjb29yZCA9IGltYWdlcy5zb3J0KCd0eXBlJyk7XG5cdFx0XHRcdHNvcnRlZDEgPSB0cnVlO1xuXHRcdFx0fVxuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGNvb3JkID0gaW1hZ2VzLnNvcnQoJ2Rpcy10eXBlJyk7XG5cdFx0XHRcdHNvcnRlZDEgPSBmYWxzZTtcblx0XHRcdH1cblx0XHRcdGltYWdlcy5kcmF3SW1hZ2VzKCRkcmF3aW5nLmdldENvbnRleHQoXCIyZFwiKSk7XG5cdFx0XHRzb3J0ID0gdHJ1ZTtcblx0XHRcdGxldHNEcmF3ID0gZmFsc2U7XG5cdFx0fVxuXHRcdGVsc2UgaWYoZS5jbGllbnRYID4gODQgJiYgZS5jbGllbnRYIDwgMTAxKXsgLy8gXCJEYXRlXCIgYm94XG5cdFx0XHRpZighc29ydGVkMil7XG5cdFx0XHRcdGNvb3JkID0gaW1hZ2VzLnNvcnQoJ2RhdGUnKTtcblx0XHRcdFx0c29ydGVkMiA9IHRydWU7XG5cdFx0XHR9XG5cdFx0XHRlbHNlIHtcblx0XHRcdFx0Y29vcmQgPSBpbWFnZXMuc29ydCgnZGlzLWRhdGUnKTtcblx0XHRcdFx0c29ydGVkMiA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdFx0aW1hZ2VzLmRyYXdJbWFnZXMoJGRyYXdpbmcuZ2V0Q29udGV4dChcIjJkXCIpKTtcblx0XHRcdHNvcnQgPSB0cnVlO1xuXHRcdFx0bGV0c0RyYXcgPSBmYWxzZTtcblx0XHR9XG5cdH1cblx0ZWxzZXsgLy8gU2VsZWN0aW9uXG5cdFx0aWYoc2VsZWN0KXtcblx0XHRcdGRyYXcuZHJhd0dlc3R1cmUoJGRyYXdpbmcsICdkb3duJywgZSk7XG5cdFx0XHRpbWFnZXMuc2VsZWN0aW9uKCRkcmF3aW5nLmdldENvbnRleHQoXCIyZFwiKSwgaWNvbklEKTtcblx0XHRcdFxuXHRcdFx0Y29uc3QgY29vcmRpbmF0ZXMgPSBkcmF3LmdldE1vdXNlWFlpbkNhbnZhcygkZHJhd2luZywgZSk7XG5cdFx0XHRjdXJyZW50R2VzdHVyZS5wdXNoKGNvb3JkaW5hdGVzKTtcblx0XHR9XG5cdFx0ZWxzZSB7IC8vIFBhcnRpdGlvblxuXHRcdFx0aWYocGFydGl0aW9uKSB7XG5cdFx0XHRcdGx4ID0gZHJhdy5nZXRNb3VzZVhZaW5DYW52YXMoJGRyYXdpbmcsIGUpWzBdO1xuXHRcdFx0XHRpbWFnZXMuZHJhd19wYXJ0aXRpb24oJGRyYXdpbmcsIGljb25JRCk7XG5cdFx0XHRcdGRyYXcubGluZV9wYXJ0aXRpb24oJGRyYXdpbmcsIGN1cnJlbnRHZXN0dXJlKTtcblx0XHRcdH1cblx0XHRcdGVsc2UgeyAvLyBJbml0aWFsIHN0YXRlXG5cdFx0XHRcdGRyYXcuZHJhd0dlc3R1cmUoJGRyYXdpbmcsICdkb3duJywgZSk7XG5cdFx0XHRcdGltYWdlcy5kcmF3SW1hZ2VzKCRkcmF3aW5nLmdldENvbnRleHQoXCIyZFwiKSk7XG5cdFx0XHRcdFxuXHRcdFx0XHRjb25zdCBjb29yZGluYXRlcyA9IGRyYXcuZ2V0TW91c2VYWWluQ2FudmFzKCRkcmF3aW5nLCBlKTtcblx0XHRcdFx0Y3VycmVudEdlc3R1cmUucHVzaChjb29yZGluYXRlcyk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGxldHNEcmF3ID0gdHJ1ZTtcblx0fVxuXHRcblx0XG59KTtcblxuLy8gc3RhcnQgd2hlbiBtb3VzZSBpcyBkb3duIGFuZCBtb3ZpbmdcbiRkcmF3aW5nLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGZ1bmN0aW9uKGUpIHtcblx0aWYgKGxldHNEcmF3ICYmICFzb3J0KXtcblx0XHRpZighcGFydGl0aW9uKXtcblx0XHRcdGRyYXcuZHJhd0dlc3R1cmUoJGRyYXdpbmcsICdtb3ZlJywgZSk7XG5cdFx0XHRjb25zdCBjb29yZGluYXRlcyA9IGRyYXcuZ2V0TW91c2VYWWluQ2FudmFzKCRkcmF3aW5nLCBlKTtcblx0XHRcdGN1cnJlbnRHZXN0dXJlLnB1c2goY29vcmRpbmF0ZXMpO1xuXHRcdH1cblx0XHRlbHNlIHtcblx0XHRcdGNvbnN0IHggPSBkcmF3LmdldE1vdXNlWFlpbkNhbnZhcygkZHJhd2luZywgZSlbMF07XG5cdFx0XHRjdXJyZW50R2VzdHVyZSA9IG15UmVjb2duaXplci5tb3ZlX3BhcnRpdGlvbihjdXJyZW50R2VzdHVyZSwgeCwgbHgpO1xuXHRcdFx0bHggPSB4O1xuXHRcdFx0XG5cdFx0XHRwYXJ0ID0gaW1hZ2VzLnBhcnRpdGlvbihjdXJyZW50R2VzdHVyZSwgaWNvbklEKTtcblx0XHRcdFxuXHRcdFx0aW1hZ2VzLmRyYXdfcGFydGl0aW9uKCRkcmF3aW5nLCBwYXJ0LCBpY29uSUQpO1xuXHRcdFx0ZHJhdy5saW5lX3BhcnRpdGlvbigkZHJhd2luZywgY3VycmVudEdlc3R1cmUpO1xuXHRcdH1cblx0fVxufSk7XG5cbi8vIHN0b3Agd2hlbiBtb3VzZSBpcyB1cFxuJGRyYXdpbmcuYWRkRXZlbnRMaXN0ZW5lcignbW91c2V1cCcsIGZ1bmN0aW9uKGUpIHtcblx0bGV0c0RyYXcgPSBmYWxzZTtcblx0aWYoc29ydCkge1xuXHRcdHNvcnQgPSBmYWxzZTtcblx0fVxuXHRlbHNlIHtcblx0XHRpZih0cmFpbmluZ01vZGUpIHtcblx0XHRcdGRhdGFzZXQuYWRkR2VzdHVyZVdpdGhMYWJlbChjdXJyZW50R2VzdHVyZSwgZ2VzdHVyZUlEKTtcblx0XHRcdGRhdGFzZXQucGxvdERhdGFzZXRJbkhNTCgpO1xuXHRcdFx0Z2VzdHVyZUlEKys7XG5cdFx0fVxuXHRcdGVsc2Uge1xuXHRcdFx0aWYgKHBhcnRpdGlvbikge1xuXHRcdFx0XHRwYXJ0ID0gaW1hZ2VzLnBhcnRpdGlvbihjdXJyZW50R2VzdHVyZSwgaWNvbklEKTtcblx0XHRcdFx0aW1hZ2VzLmRyYXdfcGFydGl0aW9uKCRkcmF3aW5nLCBwYXJ0LCBpY29uSUQpO1xuXHRcdFx0XHRwYXJ0aXRpb24gPSBmYWxzZTtcblx0XHRcdH1cblx0XHRcdGVsc2Uge1xuXHRcdFx0XHRjb25zdCBwcmVkaWN0ZWRMYWJlbCA9IG15UmVjb2duaXplci5wcmVkaWN0KGN1cnJlbnRHZXN0dXJlKTtcblx0XHRcdFx0aWYocHJlZGljdGVkTGFiZWwgPT0gMTEpe1xuXHRcdFx0XHRcdGltYWdlcy5zZXRDb29yZGluYXRlcyhjb29yZCk7XG5cdFx0XHRcdFx0aW1hZ2VzLmRyYXdJbWFnZXMoJGRyYXdpbmcuZ2V0Q29udGV4dChcIjJkXCIpKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZihzZWxlY3Qpe1xuXHRcdFx0XHRcdGlmKHByZWRpY3RlZExhYmVsID09IDkgfHwgcHJlZGljdGVkTGFiZWwgPT0gMTApIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwicGFydGl0aW9uXCIpO1xuXHRcdFx0XHRcdFx0cGFydCA9IGltYWdlcy5wYXJ0aXRpb24oY3VycmVudEdlc3R1cmUsIGljb25JRCk7XG5cdFx0XHRcdFx0XHRpbWFnZXMuZHJhd19wYXJ0aXRpb24oJGRyYXdpbmcsIHBhcnQsIGljb25JRCk7XG5cdFx0XHRcdFx0XHRzZWxlY3QgPSBmYWxzZTtcblx0XHRcdFx0XHRcdHBhcnRpdGlvbiA9IHRydWU7XG5cdFx0XHRcdFx0XHRkcmF3LmxpbmVfcGFydGl0aW9uKCRkcmF3aW5nLCBjdXJyZW50R2VzdHVyZSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2UgaWYocHJlZGljdGVkTGFiZWwgPCA5ICYmIHByZWRpY3RlZExhYmVsID4gMCkge1xuXHRcdFx0XHRcdGljb25JRCA9IG15UmVjb2duaXplci5zZWxlY3QoY3VycmVudEdlc3R1cmUsIGl0ZW14LCBpdGVteSk7XG5cdFx0XHRcdFx0aWYoaWNvbklELmxlbmd0aCA+IDApIHtcblx0XHRcdFx0XHRcdGltYWdlcy5zZWxlY3Rpb24oJGRyYXdpbmcuZ2V0Q29udGV4dChcIjJkXCIpLCBpY29uSUQpO1xuXHRcdFx0XHRcdFx0c2VsZWN0ID0gdHJ1ZTtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKFwic2VsZWN0aW9uXCIpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRpZighcGFydGl0aW9uKVxuXHRcdGN1cnJlbnRHZXN0dXJlID0gW107XHRcbn0pO1xuLypcbi8vIEJ1dHRvbnMgXCJUcmFpbmluZ1wiIGFuZCBcIlRlc3RpbmdcIlxuY29uc3QgJHRyYWluaW5nQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RyYWluaW5nQnRuJyk7XG5jb25zdCAkdGVzdGluZ0J0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyN0ZXN0aW5nQnRuJyk7XG5cbiR0cmFpbmluZ0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0dHJhaW5pbmdNb2RlID0gdHJ1ZTtcdFxufSk7XG5cbiR0ZXN0aW5nQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRteVJlY29nbml6ZXIuZml0KGRhdGFzZXQpO1xuXHR0cmFpbmluZ01vZGUgPSBmYWxzZTtcbn0pOyovXG4iXX0=